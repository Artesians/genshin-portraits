<html>
    <head>
        <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"></script>
    </head>
<canvas id="myCanvas" width="50" height="145">
</canvas>
</br>
<img id="undo" src="assets/undo-24px.svg" width=80 height=80 style="cursor: pointer;"> <!-- https://material.io/resources/icons/ -->
</br>

<div id="portrait-selection"></div>
<script>
    // https://upload-os-bbs.mihoyo.com/game_record/genshin/character_icon/
    let charMap = {
        "jean": "assets/UI_AvatarIcon_Qin.png",
        "amber": "assets/UI_AvatarIcon_Ambor.png",
        "lisa": "assets/UI_AvatarIcon_Lisa.png",
        "kaeya": "assets/UI_AvatarIcon_Kaeya.png",
        "barbara": "assets/UI_AvatarIcon_Barbara.png",
        "diluc": "assets/UI_AvatarIcon_Diluc.png",
        "razor": "assets/UI_AvatarIcon_Razor.png",
        "venti": "assets/UI_AvatarIcon_Venti.png",
        "klee": "assets/UI_AvatarIcon_Klee.png",
        "bennett": "assets/UI_AvatarIcon_Bennett.png",
        "noelle": "assets/UI_AvatarIcon_Noel.png",
        "fischl": "assets/UI_AvatarIcon_Fischl.png",
        "sucrose": "assets/UI_AvatarIcon_Sucrose.png",
        "mona": "assets/UI_AvatarIcon_Mona.png",
        "diona": "assets/UI_AvatarIcon_Diona.png",
        "albedo": "assets/UI_AvatarIcon_Albedo.png",
        "xiao": "assets/UI_AvatarIcon_Xiao.png",
        "beidou": "assets/UI_AvatarIcon_Beidou.png",
        "ningguang": "assets/UI_AvatarIcon_Ningguang.png",
        "xiangling": "assets/UI_AvatarIcon_Xiangling.png",
        "xingqiu": "assets/UI_AvatarIcon_Xingqiu.png",
        "chongyun": "assets/UI_AvatarIcon_Chongyun.png",
        "qiqi": "assets/UI_AvatarIcon_Qiqi.png",
        "keqing": "assets/UI_AvatarIcon_Keqing.png",
        "tartaglia": "assets/UI_AvatarIcon_Tartaglia.png",
        "zhongli": "assets/UI_AvatarIcon_Zhongli.png",
        "xinyan": "assets/UI_AvatarIcon_Xinyan.png",
        "ganyu": "assets/UI_AvatarIcon_Ganyu.png",
        "hutao": "assets/UI_AvatarIcon_Hutao.png"
    };
    let iconMap = {
        "malemc": "assets/UI_AvatarIcon_PlayerBoy.png",
        "femalemc": "assets/UI_AvatarIcon_PlayerGirl.png",
        "fillslot": "assets/abstract-user-flat-3-colored.svg", // https://freesvg.org/user-icon-picture
    };
    //https://stackoverflow.com/questions/5467129/sort-javascript-object-by-key
    charMap = Object.keys(charMap).sort().reduce(
        (obj, key) => { 
            obj[key] = charMap[key]; 
            return obj;
        }, 
        {}
    );
    for (let iconName in iconMap){
        charMap[iconName] = iconMap[iconName];
    }

    let framePad = 15; // Padding around portrait frame
    let portraitPad = 5; // Padding around image
    let leftPad = 20;
    let spacing = 12;
    let portraitSize = 106;
    let selectedChars = [];
    let totalHeight = 145;
    let frameSize = portraitSize+2*portraitPad;
    for (let charName in charMap) {
        //https://stackoverflow.com/questions/8013792/how-to-create-a-new-img-tag-with-jquery-with-the-src-and-id-from-a-javascript-o
        let pimg = $("<img>")
        pimg.attr("style", "cursor: pointer;");
        pimg.attr('src', charMap[charName]); 
        pimg.attr('width', portraitSize);
        pimg.attr('height', portraitSize);
        pimg.click(function(){
            console.log(charName);
            selectedChars.push(charName);
            makePortraits(selectedChars);
        });
        $("#portrait-selection").append(pimg);
    }

    $("#undo").click(function(){
        if(selectedChars.length > 0){
            selectedChars.pop();
            makePortraits(selectedChars);
        }
    });
    // https://stackoverflow.com/questions/1255512/how-to-draw-a-rounded-rectangle-on-html-canvas
    function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
        if (typeof stroke === 'undefined') {
            stroke = true;
        }
        if (typeof radius === 'undefined') {
            radius = 5;
        }
        if (typeof radius === 'number') {
            radius = {tl: radius, tr: radius, br: radius, bl: radius};
        } else {
            var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};
            for (var side in defaultRadius) {
            radius[side] = radius[side] || defaultRadius[side];
            }
        }
        ctx.beginPath();
        ctx.moveTo(x + radius.tl, y);
        ctx.lineTo(x + width - radius.tr, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
        ctx.lineTo(x + width, y + height - radius.br);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
        ctx.lineTo(x + radius.bl, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
        ctx.lineTo(x, y + radius.tl);
        ctx.quadraticCurveTo(x, y, x + radius.tl, y);
        ctx.closePath();
        if (fill) {
            ctx.fill();
        }
        if (stroke) {
            ctx.stroke();
        }
    }
    function makePortraits(images){
        let totalWidth = framePad*2 + frameSize*images.length + spacing*(images.length-1);
        $("#myCanvas").attr("width", totalWidth)
        let c = document.getElementById("myCanvas");
        let ctx = c.getContext("2d");
        //https://stackoverflow.com/questions/6011378/how-to-add-image-to-canvas
        ctx.fillStyle = "#02041C";

        roundRect(ctx, 0, 0, totalWidth, totalHeight, radius=8, fill=true);
        for(let i = 0; i < images.length; i++){
            let baseImage = new Image();
            imageName = images[i];
            console.log(imageName)
            let leftBorder = framePad + i*(frameSize+spacing)
            ctx.fillStyle = "#0B0923";
            roundRect(ctx, leftBorder, framePad, frameSize, portraitSize+2*portraitPad, radius=4, fill=true);
            baseImage.src = charMap[imageName];
            baseImage.onload = function(){
                ctx.drawImage(baseImage, leftBorder + portraitPad, framePad + portraitPad, portraitSize, portraitSize);
            }
        }
    }
    makePortraits([]);
    

    // Create gradient
    
    // var grd = ctx.createLinearGradient(0, 0, 400, 0);
    // grd.addColorStop(0, "red");
    // grd.addColorStop(1, "white");

    // Fill with gradient
    //ctx.fillStyle = grd;
    //ctx.fillRect(10, 10, 150, 111);
    // https://stackoverflow.com/questions/18480474/how-to-save-an-image-from-canvas
    // function download(canvas, filename) {
    //     /// create an "off-screen" anchor tag
    //     var lnk = document.createElement('a'),
    //         e;

    //     /// the key here is to set the download attribute of the a tag
    //     lnk.download = filename;

    //     /// convert canvas content to data-uri for link. When download
    //     /// attribute is set the content pointed to by link will be
    //     /// pushed as "download" in HTML5 capable browsers
    //     lnk.href = c.toDataURL();

    //     /// create a "fake" click-event to trigger the download
    //     if (document.createEvent) {

    //         e = document.createEvent("MouseEvents");
    //         e.initMouseEvent("click", true, true, window,
    //                         0, 0, 0, 0, 0, false, false, false,
    //                         false, 0, null);

    //         lnk.dispatchEvent(e);

    //     } else if (lnk.fireEvent) {

    //         lnk.fireEvent("onclick");
    //     }
    // }
    // <img src="https://genshin.honeyhunterworld.com/img/char/amber.png">

    // if(imageName !== "empty"){
    //     baseImage.src = charMap[imageName];
    //     baseImage.onload = function(){
    //         // ctx.fillStyle = "#081030";
    //         ctx.fillStyle = "#0B0923";
    //         ctx.drawImage(baseImage, leftBorder + portraitPad, framePad + portraitPad);
    //     }
    // }
    //https://codepo8.github.io/canvas-images-and-pixels/resize.html
</script>
</html>

